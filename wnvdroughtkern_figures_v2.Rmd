---
title: "Figures"
output: html_document
date: "2025-05-24"
---

This script is to re-create the figures for the following manuscript:

**Title** The paradoxical impact of drought on West Nile virus risk: insights from long-term ecological data

*Authors* S Sambado*, T J Sipin, Z Rennie, A Larsen, J Cunningham, A Quandt, D Sousa, A J MacDonald

*corresponding author: sbsambado-at-ucsb.edu / ssambado-at-stanford.edu


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

### upload necessary packages
library(tidyverse)
library(ggplot2)
library(ggpubr)
library(modelsummary)
library(ggmap)


### upload necessary data
## for Main Text
# mosquito abundances full
abund_tar_full <- read.csv("data/abund_tar_full_clean.csv") %>% dplyr::select(-X)
abund_quin_full <- read.csv("data/abund_quinq_full_clean.csv") %>% dplyr::select(-X)

# panel data for abundances
abund_tar_panel <- read.csv("data/abund_tar_panel_clean.csv") %>% dplyr::select(-X)
abund_quin_panel <- read.csv("data/abund_quin_panel_clean.csv") %>% dplyr::select(-X)
# panel data for wnv mir 
wnv_tar_panel <- read.csv("data/wnvmir_tar_panel_clean.csv")  %>% dplyr::select(-X)
wnv_quin_panel <- read.csv("data/wnvmir_quin_panel_clean.csv")  %>% dplyr::select(-X)

## for Supporting Information
# climate figures
climate_full <- read.csv("data/climate_full_clean.csv") %>% dplyr::select(-X)
# trap station figures
landuse <- read.csv("data/landuse_clean.csv")  %>% dplyr::select(-X)
trap_station <- read.csv("data/trapstation_info_clean.csv") %>% dplyr::select(-X)
# pesticide figures
pesticide <- read.csv("data/pesticide_kernco_clean.csv") %>% dplyr::select(-X)
```

#Main Text

##Figure 1
```{r}
## Panel A -- Made outside of R


## Panel B
fig1_b <- abund_tar_full %>% 
  # calculate mean PDSI per year
  group_by(year) %>% 
  summarise(mean_pdsi = mean(pdsi, na.rm = TRUE)) %>% 
  # assign wet/dry based on known PDSI thresholds
  mutate(status = case_when(mean_pdsi >= 0 ~ "wet", 
                            mean_pdsi < 0 ~ "dry")) %>%
  ggplot(aes(x = factor(year), y = mean_pdsi, group = year, fill = status)) +
  geom_bar(stat = "identity") +
  theme_classic() +
  theme(axis.title.y = element_text(face = "bold", size = 14),
        axis.text.x = element_text(size = 14)) +
  labs(y = "Drought Index", x = "") +
  # highlight baseline values of PDSI
  geom_hline(yintercept = 0, lty = 2) +
  scale_fill_manual(values = c("#ae2012", "#005f73")) +
  guides(fill = FALSE) +
  # create x axis where every other year is labeled
  scale_x_discrete(labels = function(x) {
    ifelse(as.numeric(x) %% 2 == 0,x, "")})
#ggsave(fig1_b,file = "figures/main/fig1_b.jpeg",height = 5, width = 5)


## Panel C
# combine wnv testing data into 1 file for figures
wnv_both_panel <- bind_rows(wnv_tar_panel,wnv_quin_panel)

fig1_b <- wnv_both_panel %>% 
  # calculate mean MIR for each year-species
  group_by(year, species) %>% 
  summarise(mean_mir = mean(mir, na.rm = TRUE)) %>% 
  ggplot(aes(x = as.factor(year), y = mean_mir, group = species, color = species)) +
  geom_line() +
  geom_point(size = 1.5) +
  theme_classic() +
  theme(axis.title.y = element_text(face = "bold", size = 14),
        axis.text.x = element_text(size = 14)) +
  labs(y = "WNV MIR", x = "") +
  scale_color_manual(values = c("#8b8c89","#008000")) +
  guides(fill = FALSE) +
  scale_x_discrete(labels = function(x) {
    ifelse(as.numeric(x) %% 2 == 0,x, "")
  }) +
  guides(color = FALSE) 
#ggsave(fig1_c,file = "figures/main/fig1_c.jpeg",height = 5, width = 5)


## Panel D
abund_both_panel <- bind_rows(abund_tar_full, abund_quin_full)

abund_both_panel %>% 
  # calculate mean mos per trap night for each year-species
  group_by(year, species) %>% 
  summarise(mean_mos = mean(mos_per_trap_night, na.rm = TRUE)) %>% 
  ggplot(aes(x = as.factor(year), y = log(mean_mos), group = species, color = species)) +
  geom_line() +
  geom_point(size = 1.5) +
  theme_classic() +
  theme(axis.title.y = element_text(face = "bold", size = 14),
        axis.text.x = element_text(size = 14)) +
  labs(y = "log(Mosquito Count)", x = "", color = "Species") +
  scale_color_manual(values = c("#8b8c89","#008000")) +
  guides(fill = FALSE) +
  scale_x_discrete(labels = function(x) {
    ifelse(as.numeric(x) %% 2 == 0,x, "")
  }) +
  theme(legend.position = c(.5,.8),
        legend.title = element_text(face = "bold", size = 14),
        legend.text = element_text(size = 13)) +
  # make legend guide easier to read
    guides(color = guide_legend(
    title.position = "top", # place title on top
    title.hjust = 0.5, # center title
    direction = "horizontal", # keys should be horizontal
    nrow = 1 # only 1 row of keys
  ))
#ggsave(fig1_d,file = "figures/main/fig1_d.jpeg",height = 5, width = 5)
```


##Figure 2
Made in Biorender

##Figure 3
```{r}
## Panel A
# because month is numeric, let's assign month names for numeric
month_lookup <- setNames(1:12, month.name)

fig3_a <- abund_tar_panel %>% 
  # convert month numeric to month name
  mutate(month_num = month_lookup[month]) %>% 
  # calculate mean river discharge by year-month
  group_by(year, month_num) %>% 
  summarise(mean_cms = mean(woy_cms_mean, na.rm = TRUE)) %>% 
  ggplot(aes(x = month_num, y = mean_cms, group = year, color = as.factor(year))) +
  geom_line() +
  geom_point(size = 2) +
  theme_classic() +
  theme(axis.title.y = element_text(face = "bold", size = 14),
        legend.position = "bottom",
        legend.title = element_text(face = "bold", size = 15, vjust = .8),
        legend.text = element_text(size = 14),
        # make plot tag font bigger and bold
        plot.tag = element_text(size = 16, face = "bold")) +
  labs(y = "Kern River Discharge\n Mean (cms)", x = "", color = "Year", tag = "A") +
  # color code years by driest to wetter
  scale_color_manual(values = c("#9C0824FF", "#b3101B", "#C51517", "#d21e1c",
  "#dc4636", "#ec6857", "#f78e80","#e9a79d",
  "#d6bfbb", "#9cbbcf", "#78b1d3",
  "#3482b6", "#1c5a99", "#26456E"),
  # year order was determined by mean annual PDSI with driest first (2014)
                     breaks = c("2014", "2021", "2013", "2022",
                                "2018", "2015", "2012", "2016",
                                "2010", "2020","2019",
                                "2017","2023", "2011")) +
  # legend keys in 2 rows
  guides(color = guide_legend(nrow = 2, byrow = TRUE)) +
  # give x axis month labels
  scale_x_continuous(breaks = 4:10, labels = month.abb[4:10],expand = c(0.01,0.01)) 
#ggsave(fig3_a,file = "figures/main/fig3_a.jpeg",height = 5, width = 5)


## Panel B
fig3_b <- wnv_both_panel %>% 
  mutate(month_num = month_lookup[month]) %>% 
  # calculate mean bird community competency index per year-month
  group_by(year, month_num) %>% 
  # filter out months during non-peak season (April-October)
  filter(month_num > 3 & month_num < 11 ) %>% 
  summarise(mean_competency = mean(mean_competency, na.rm = TRUE)) %>% 
  ggplot(aes(x = month_num, y = mean_competency, group = year, color = as.factor(year))) +
  geom_line() +
  geom_point(size = 2) +
  theme_classic() +
  theme(axis.title.y = element_text(face = "bold", size = 14),
        legend.position = "bottom",
        legend.title = element_text(face = "bold", size = 15, vjust = .8),
        legend.text = element_text(size = 14),
        plot.tag = element_text(size = 16, face = "bold")) +
  labs(y = "Bird Community\n Competency Mean", x = "", color = "Year", tag = "B") +
  scale_color_manual(values = c("#9C0824FF", "#b3101B", "#C51517", "#d21e1c",
  "#dc4636", "#ec6857", "#f78e80","#e9a79d",
  "#d6bfbb", "#9cbbcf", "#78b1d3",
  "#3482b6", "#1c5a99", "#26456E"),
                     breaks = c("2014", "2021", "2013", "2022",
                                "2018", "2015", "2012", "2016",
                                "2010", "2020","2019",
                                "2017","2023", "2011")) +
  guides(color = guide_legend(nrow = 2, byrow = TRUE)) +
  scale_x_continuous(breaks = 4:10, labels = month.abb[4:10],expand = c(0.01,0.01)) 


## Combine them
fig3_combo <- ggarrange(fig3_a, fig3_b, common.legend = TRUE, legend = "bottom")
#ggsave(fig3_combo, file = "figures/main/fig3_combo.jpeg", dpi = 600, width = 8, height = 4)

```

##Figure 4

Fit main panel models
```{r}
## more details about model fitting can be found in analysis .Rmd

## ABUNDANCE
# Cx. tarsalis
mod_abund_tar <- feols(log(mos_per_trap_night + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized |
                         clust + month,
                       # specify conley standard errors
                       vcov = "conley",
                       data = abund_tar_panel)

# Cx. quinquefasciatus
mod_abund_quin <- feols(log(mos_per_trap_night + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized |
                         clust + month,
                      # specify conley standard errors  
                       vcov = "conley",
                       data = abund_quin_panel)


## WNV MIR
# Cx. tarsalis
mod_wnv_tar <- feols(log(mir + 1) ~
                       pdsi_standardized_lag_1month + 
                       woy_cms_mean_standardized + 
                       mean_competence_standardized |
                       clust + month,
                     # specify conley standard errors
                       vcov = "conley",
                       data = wnv_tar_panel)

# Cx. quinquefasciatus
mod_wnv_quin <- feols(log(mir + 1) ~
                       pdsi_standardized_lag_1month + 
                       woy_cms_mean_standardized + 
                       mean_competence_standardized |
                       clust + month,
                     # specify conley standard errors
                       vcov = "conley",
                       data = wnv_quin_panel)

## combine models into list for plotting
models_final <- list(mod_abund_tar, mod_abund_quin,mod_wnv_tar,mod_wnv_quin)
```


Plot models
```{r}
## plot model results using `modelsummary` function modelplot()
modelplot(models_final, # list of model results from above section
          coef_omit = c(2:3),# only keep PDSI coefficients
          coef_rename =  c("pdsi_standardized_lag_1month" =""),
          size = 1.1) +
  ## now work on aesthetics
  coord_flip() +
  geom_vline(xintercept = 0, color = "black", linewidth = 1) + # baseline value of non-effect
  # give mos species certain colors
  scale_color_manual(name = "Species",
                     labels = c("Cx. tarsalis", "Cx. quinquefasciatus", "",""),
                     values = c("#008000","#8b8c89","#008000","#8b8c89"),
                     guide = guide_legend(override.aes = list(alpha = c(1, 1, 0, 0)))) +
  # change the appearances of the grap
  theme(axis.title = element_text( size = 14,face = "bold"),
        axis.text.x = element_text(size = 14, face = "bold"),
        axis.text.y = element_text(size = 14),
        
        legend.title = element_text(face = "bold", size = 14),
        legend.position = "bottom",
        legend.text = element_text(size = 13),
        legend.margin = margin(0, 0, 0, 0),       
        legend.box.margin = margin(0, 0, 0, 0),
        legend.box.spacing = unit(0, "pt"),
        
        plot.title = element_text(face = "bold", size = 14)) +
  # get rid of white space
  scale_y_discrete(expand = c(0,0)) +
  labs(x = "Coefficient Estimate (PDSI)") 
  
## further annotate the figure
fig_models_final_annotated <-
  fig_models_final +
  # bc of coord_flip(), x is the height of the text
    annotate("text", x = .143, y = .87, label = "Abundance Model", fontface = "bold", size = 5) +
    annotate("text", x = .143, y = 1.12, label = "WNV MIR Model", fontface = "bold", size = 5) +
    geom_hline(yintercept = 1,  lty=2) # splits abundance from MIR model

#ggsave(fig_models_final_annotated, file = "figures/main/fig4.jpeg", width = 5, height = 5, dpi = 600)
```


#Supporting Information

##Figure S1
```{r}
## Panel A
fig_s1_a <- abund_tar_panel %>% 
  # calculate mean PDSI per year-clust
  group_by(year, clust) %>% 
  summarise(mean_pdsi = mean(pdsi, na.rm = TRUE)) %>% 
  ggplot(aes(x = factor(year), y = mean_pdsi)) +
  geom_hline(yintercept = 0, color = "grey50", linewidth = 2) +
  geom_point(alpha = .9) +
  geom_boxplot() +
  theme_classic() +
  labs(y = "Drought Index (PDSI)", x = "", tag = "A") +
  theme(axis.title = element_text(face = "bold", size = 16),
        axis.text.y = element_text(size = 14),
        axis.text.x = element_text(size = 14),
        plot.tag = element_text(size = 16, face = "bold")) +
  scale_x_discrete(labels = function(x) {
    ifelse(as.numeric(x) %% 2 == 0,x, "")
  }) 


## Panel B
fig_s1_b <- climate_full %>% 
  # calculate mean max temp per year-clust
  group_by(year, clust) %>% 
  summarise(mean_maxtemp = mean(tmmx_C, na.rm = TRUE)) %>%
  # get rid of NA years and 2009 (not during study period)
  filter(!is.na(year) & year != 2009) %>% 
  ggplot(aes(x = factor(year), y = mean_maxtemp)) +
  geom_point(alpha = .9) +
  geom_boxplot() +
  theme_classic() +
  labs(y = "Max Temp (°C)", x = "", tag = "B") +
  theme(axis.title = element_text(face = "bold", size = 16),
        axis.text.y = element_text(size = 14),
        axis.text.x = element_text(size = 14),
        plot.tag = element_text(size = 16, face = "bold")) +
  scale_x_discrete(labels = function(x) {
    ifelse(as.numeric(x) %% 2 == 0,x, "")
  }) 


## Panel C
fig_s1_c <- climate_full %>% 
  # calculate mean total precip per water year (Nov-March) 
    filter(water_year != 2009 & water_year != 2024) %>% 
  group_by(water_year) %>% 
  summarise(mean = mean(pr_sum_wateryear)) %>% 
  ggplot(aes(x = factor(water_year), y = mean)) +
  geom_bar(stat = "identity",color = "black", fill = "grey80") +
  theme_classic() +
  labs(y = "Total Precipitation (mm)", x = "", tag = "C") +
  theme(axis.title = element_text(face = "bold", size = 16),
        axis.text.y = element_text(size = 14),
        axis.text.x = element_text(size = 14),
        plot.tag = element_text(size = 16, face = "bold")) +
  scale_x_discrete(expand = c(0,0),
                   labels = function(x) {
    ifelse(as.numeric(x) %% 2 == 0,x, "")
  }) +
  scale_y_continuous(expand = c(0,0)) 


## Combine
fig_s1_combo <- ggarrange(fig_s1_a, fig_s1_b, fig_s1_c, ncol = 3)

#ggsave(fig_s1_combo , file = "figures/supplement/fig_s1_combo.jpeg", dpi = 600, width = 14, height = 5)
```

##Figure S2
```{r}
## Panel A -- made outside of R


## Panel B
# find median lon/lat of study area
location <- with(landuse,
                 c(lon = median(lon),
                   lat = median(lat)))

# get ggmap based on median lon/lat
#register_google(key = "AIzaSyC7-ux51sDeZvS8YxNxOkCZ-5_hMYpfAvY", write = TRUE)
kern_map <- get_map(location = location,
                    zoom = "auto", 
                    color = "bw")

fig_s2_b <- ggmap(kern_map) + # pull base map from ggmaps
  geom_point(data = landuse, aes(x = lon, y = lat, color = land_bin2020)) + # add points of clusters
  geom_point(alpha = .7) +
  scale_color_manual(values = c( "#264653", "#2a9d8f", "#e9c46a", "#f4a261", "#e76f51")) +
  labs(y = "", x = "", color = "Landuse Category") +
  theme(axis.title = element_blank(),
        axis.text = element_blank(),
        # change aesthetics
        legend.key = element_rect(color = NA, fill = NA),
        legend.position = c(.83,.82),
        legend.margin = margin(0.1,0.1,0.1,0.1),
        legend.title.position = "top",
        legend.title.align = .5,
        legend.title = element_text(face = "bold"))
#ggsave(fig_s2_b, file = "figures/supplement/fig_s2_c.jpeg", dpi = 600, height = 5, width = 5)



## Panel C
fig_s2_c <- trap_station %>% 
  # tally the uniqe trap stations within a clusterID
  group_by(clust) %>% 
  tally() %>% 
  ggplot(aes(x = clust, y = n)) +
  geom_bar(stat = "identity", color = "black", fill = "grey80") +
  theme_classic() +
  labs(y = "Number of Unique Trap Stations", x = "ClusterID") +
  theme(axis.title = element_text(face = "bold", size = 16),
        axis.text.y = element_text(size = 14),
        axis.text.x = element_text(size = 14)) +
  # get rid of white space and state desired breaks
  scale_x_continuous(expand = c(0,0), n.breaks = 20) +
  scale_y_continuous(expand = c(0,0), n.breaks = 11)
#ggsave(fig_s2_c, file = "figures/supplement/fig_s2_b.jpeg", dpi = 600, height = 5, width = 8)

```

##Figure S3
```{r}
## Panel A
# pull 12 color values
getpal = colorRampPalette(brewer.pal(12, "Spectral"))

larvicide <- pesticide %>% 
  # calculate mean lbs of larvicide applied in kern county
  filter(mos_life_stage_target == "Larvicide") %>% 
  group_by(year, month_in_year) %>% 
  summarise(mean = mean(pounds_chemical_applied, na.rm = TRUE)) %>% 
  ggplot(aes(x = factor(year), y = log(mean+1))) +
  geom_boxplot(fill = "grey90") +
  geom_point(alpha = .9, aes(color = factor(month_in_year))) +
  theme_classic() +
  labs(y = "log(Larvicide)\n (lbs)", x = "", tag = "A", color = "Month") +
  theme(axis.title = element_text(face = "bold", size = 16),
        axis.text.y = element_text(size = 14),
        axis.text.x = element_text(size = 14),
        legend.position = "bottom",
        legend.title = element_text(face = "bold"),
        plot.tag = element_text(size = 16, face = "bold")) +
  scale_x_discrete(labels = function(x) {
    ifelse(as.numeric(x) %% 2 == 0,x, "")
  }) +
  scale_color_manual(values = getpal(12)) +
  guides(color = guide_legend(nrow = 1, byrow = TRUE)) 


adulticide <- pesticide %>% 
  # calculate mean lbs of adulticide applied in kern county
  filter(mos_life_stage_target == "Adulticide") %>% 
  group_by(year, month_in_year) %>% 
  summarise(mean = mean(pounds_chemical_applied, na.rm = TRUE)) %>% 
  ggplot(aes(x = factor(year), y = log(mean+1))) +
  geom_boxplot(fill = "grey90") +
  geom_point(alpha = .9, aes(color = factor(month_in_year))) +
  theme_classic() +
  labs(y = "log(Adulticide)\n (lbs)", x = "", tag = "B", color = "Month") +
  theme(axis.title = element_text(face = "bold", size = 16),
        axis.text.y = element_text(size = 14),
        axis.text.x = element_text(size = 14),
        legend.position = "bottom",
        legend.title = element_text(face = "bold"),
        plot.tag = element_text(size = 16, face = "bold")) +
  scale_x_discrete(labels = function(x) {
    ifelse(as.numeric(x) %% 2 == 0,x, "")
  }) +
  scale_color_manual(values = getpal(12)) +
  guides(color = guide_legend(nrow = 1, byrow = TRUE)) 


## combine them
fig_s3_combo <- ggarrange(larvicide, adulticide, ncol = 1, align = "hv", 
          common.legend = TRUE, legend = "bottom")

#ggsave(fig_s3_combo, file = "figures/supplement/fig_s3_combo.jpeg", dpi = 600)
```

##Figure S4
Coefficient estimates for abundance models with different fixed effects
Fit models
```{r}
### within-estimator panel models
## TARSALIS
mod_abund_tar_re_none <- feols(log(mos_per_trap_night + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized, 
                       
                       vcov = "conley",
                       data = abund_tar_panel)


mod_abund_tar_re_clust <- feols(log(mos_per_trap_night + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized |
                         clust,
                       
                       vcov = "conley",
                       data = abund_tar_panel)

mod_abund_tar_re_month <- feols(log(mos_per_trap_night + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized |
                         month,
                       
                       vcov = "conley",
                       data = abund_tar_panel)


mod_abund_tar_re_year <- feols(log(mos_per_trap_night + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized |
                         year,
                       
                       vcov = "conley",
                       data = abund_tar_panel)

mod_abund_tar_re_clustmonth <- feols(log(mos_per_trap_night + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized |
                         clust + month,
                       
                       vcov = "conley",
                       data = abund_tar_panel)


mod_abund_tar_re_clustmonthyear <- feols(log(mos_per_trap_night + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized |
                         clust + month + year,
                       
                       vcov = "conley",
                       data = abund_tar_panel)


## QUINQ
mod_abund_quin_re_none <- feols(log(mos_per_trap_night + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized, 
                       
                       vcov = "conley",
                       data = abund_quin_panel)


mod_abund_quin_re_clust <- feols(log(mos_per_trap_night + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized |
                         clust,
                       
                       vcov = "conley",
                       data = abund_quin_panel)

mod_abund_quin_re_month <- feols(log(mos_per_trap_night + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized |
                         month,
                       
                       vcov = "conley",
                       data = abund_quin_panel)


mod_abund_quin_re_year <- feols(log(mos_per_trap_night + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized |
                         year,
                       
                       vcov = "conley",
                       data = abund_quin_panel)

mod_abund_quin_re_clustmonth <- feols(log(mos_per_trap_night + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized |
                         clust + month,
                       
                       vcov = "conley",
                       data = abund_quin_panel)


mod_abund_quin_re_clustmonthyear <- feols(log(mos_per_trap_night + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized |
                         clust + month + year,
                       
                       vcov = "conley",
                       data = abund_quin_panel)
```

Plot models
```{r}
# make list of models
## TARSALIS
models_abund_re_tar_list <- list(mod_abund_tar_re_none, 
                                 mod_abund_tar_re_clust, mod_abund_tar_re_month,mod_abund_tar_re_year, 
                                 mod_abund_tar_re_clustmonth, mod_abund_tar_re_clustmonthyear) 


models_abund_re_tar_coeff <- 
  modelplot(models_abund_re_tar_list,
                                       coef_omit = "Intercept",
            # change name of coefficients 
            
                                       coef_rename = c("pdsi_standardized_lag_1month" ="PDSI lag 1-month",
                                                       "woy_cms_mean_standardized" = "Kern River Discharge"),

                                       size = .5) +
    coord_flip() +
    geom_vline(xintercept = 0, color = "black", linewidth = 1) +
    scale_y_discrete(expand = c(0,0.5)) +
    
    labs(x = "Coefficient Estimate", title = "Cx. tarsalis") +

    theme(axis.title = element_text( size = 14,face = "bold"),
          axis.text.x = element_text(size = 14, face = "bold"), # element_blank()
          axis.text.y = element_text(size = 14),
          
          legend.title = element_text(face = "bold", size = 14),
          legend.position = "bottom",
          legend.text = element_text(size = 13),
          legend.margin = margin(0, 0, 0, 0), 
          legend.box.margin = margin(0, 0, 0, 0),
          
          plot.title = element_text(face = "bold", size = 14)) +
  # change aesthetics for legend
    scale_color_manual(name = "Fixed Effects", # title
                       values = getpal(6), # colors
                       labels = c("OLS", 
                                  "Clust", "Month", "Year",
                                  "Clust + Month", "Clust + Month + Year")) +
  guides(color = guide_legend(title.position = "top", direction = "horizontal",   nrow = 1))

## QUINQ
models_abund_re_quin_list <- list(mod_abund_quin_re_none, 
                                 mod_abund_quin_re_clust, mod_abund_quin_re_month,mod_abund_quin_re_year, 
                                 mod_abund_quin_re_clustmonth, mod_abund_quin_re_clustmonthyear) 


models_abund_re_quin_coeff <- 
  modelplot(models_abund_re_quin_list,
                                       coef_omit = "Intercept",
            
                                       coef_rename = c("pdsi_standardized_lag_1month" ="PDSI lag 1-month",
                                                       "woy_cms_mean_standardized" = "Kern River Discharge"),

                                       size = .5) +
    coord_flip() +
    geom_vline(xintercept = 0, color = "black", linewidth = 1) +
    scale_y_discrete(expand = c(0,0.5)) +
    
    labs(x = "Coefficient Estimate", title = "Cx. quinquefasciatus") +

    theme(axis.title = element_text( size = 14,face = "bold"),
          axis.text.x = element_text(size = 14, face = "bold"), # element_blank()
          axis.text.y = element_text(size = 14),
          
          legend.title = element_text(face = "bold", size = 14),
          legend.position = "bottom",
          legend.text = element_text(size = 13),
          legend.margin = margin(0, 0, 0, 0), 
          legend.box.margin = margin(0, 0, 0, 0),
          
          plot.title = element_text(face = "bold", size = 14)) +
    scale_color_manual(name = "Fixed Effects",
                       values = getpal(6), 
                       labels = c("OLS", 
                                  "Clust", "Month", "Year",
                                  "Clust + Month", "Clust + Month + Year"))  +
  guides(color = guide_legend(title.position = "top", direction = "horizontal",   nrow = 1))
     
    
                


  
  
## Combine
  
models_abund_re_coeff <- ggarrange(models_abund_re_tar_coeff + rremove("xlab") + rremove("ylab"), 
          models_abund_re_quin_coeff + rremove("ylab"), 
          ncol = 1, align = "hv", 
          common.legend = TRUE, legend = "bottom",
          font.label = list(size = 12))


models_abund_re_coeff_an <- annotate_figure(models_abund_re_coeff,
                                            left = text_grob("Coefficient Estimate",
                                                             rot = 90, face = "bold", size = 11,
                                                             hjust = .3))


#ggsave(models_abund_re_coeff_an, file = "figures/supplement/fig_s4.jpeg", dpi = 600)

```

##Figure S5
Coefficient estimates for WNV MIR with different fixed effects

Fit models
```{r}
### within-estimator panel models
## TARSALIS
mod_wnv_tar_re_none <- feols(log(mir + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized +
                         mean_competence_standardized, 
                       
                       vcov = "conley",
                       data = wnv_tar_panel)


mod_wnv_tar_re_clust <- feols(log(mir + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized +
                         mean_competence_standardized |
                         clust,
                       
                       vcov = "conley",
                       data = wnv_tar_panel)

mod_wnv_tar_re_month <- feols(log(mir + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized +
                         mean_competence_standardized |
                         month,
                       
                       vcov = "conley",
                       data = wnv_tar_panel)


mod_wnv_tar_re_year <- feols(log(mir + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized +
                         mean_competence_standardized |
                         year,
                       
                       vcov = "conley",
                       data = wnv_tar_panel)

mod_wnv_tar_re_clustmonth <- feols(log(mir + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized +
                         mean_competence_standardized |
                         clust + month,
                       
                       vcov = "conley",
                       data = wnv_tar_panel)


mod_wnv_tar_re_clustmonthyear <- feols(log(mir + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized +
                         mean_competence_standardized |
                         clust + month + year,
                       
                       vcov = "conley",
                       data = wnv_tar_panel)


## QUINQ
mod_wnv_quin_re_none <- feols(log(mir + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized +
                         mean_competence_standardized, 
                       
                       vcov = "conley",
                       data = wnv_quin_panel)


mod_wnv_quin_re_clust <- feols(log(mir + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized +
                         mean_competence_standardized |
                         clust,
                       
                       vcov = "conley",
                       data = wnv_quin_panel)

mod_wnv_quin_re_month <- feols(log(mir + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized +
                         mean_competence_standardized |
                         month,
                       
                       vcov = "conley",
                       data = wnv_quin_panel)


mod_wnv_quin_re_year <- feols(log(mir + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized +
                         mean_competence_standardized |
                         year,
                       
                       vcov = "conley",
                       data = wnv_quin_panel)

mod_wnv_quin_re_clustmonth <- feols(log(mir + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized +
                         mean_competence_standardized |
                         clust + month,
                       
                       vcov = "conley",
                       data = wnv_quin_panel)


mod_wnv_quin_re_clustmonthyear <- feols(log(mir + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized +
                         mean_competence_standardized |
                         clust + month + year,
                       
                       vcov = "conley",
                       data = wnv_quin_panel)
```

Plot models
```{r}
## TARSALIS
models_wnv_re_tar_list <- list(mod_wnv_tar_re_none, 
                                 mod_wnv_tar_re_clust, mod_wnv_tar_re_month,mod_wnv_tar_re_year, 
                                 mod_wnv_tar_re_clustmonth, mod_wnv_tar_re_clustmonthyear) 


models_wnv_re_tar_coeff <- 
  modelplot(models_wnv_re_tar_list,
                                       coef_omit = "Intercept",
            
                                       coef_rename = c("pdsi_standardized_lag_1month" ="PDSI lag 1-month",
                                                       "woy_cms_mean_standardized" = "Kern River Discharge",
                                                       "mean_competence_standardized" = "Bird Competency Index"),

                                       size = .5) +
    coord_flip() +
    geom_vline(xintercept = 0, color = "black", linewidth = 1) +
    scale_y_discrete(expand = c(0,0.5)) +
    
    labs(x = "Coefficient Estimate", title = "Cx. tarsalis") +

    theme(axis.title = element_text( size = 14,face = "bold"),
          axis.text.x = element_text(size = 14, face = "bold"), # element_blank()
          axis.text.y = element_text(size = 14),
          
          legend.title = element_text(face = "bold", size = 14),
          legend.position = "bottom",
          legend.text = element_text(size = 13),
          legend.margin = margin(0, 0, 0, 0), 
          legend.box.margin = margin(0, 0, 0, 0),
          
          plot.title = element_text(face = "bold", size = 14)) +
    scale_color_manual(name = "Fixed Effects",
                       values = getpal(6), 
                       labels = c("OLS", 
                                  "Clust", "Month", "Year",
                                  "Clust + Month", "Clust + Month + Year")) +
  guides(color = guide_legend(title.position = "top", direction = "horizontal",   nrow = 1))
  
## QUINQ
models_wnv_re_quin_list <- list(mod_wnv_quin_re_none, 
                                 mod_wnv_quin_re_clust, mod_wnv_quin_re_month,mod_wnv_quin_re_year, 
                                 mod_wnv_quin_re_clustmonth, mod_wnv_quin_re_clustmonthyear) 


models_wnv_re_quin_coeff <- 
  modelplot(models_wnv_re_quin_list,
                                       coef_omit = "Intercept",
            
                                       coef_rename = c("pdsi_standardized_lag_1month" ="PDSI lag 1-month",
                                                       "woy_cms_mean_standardized" = "Kern River Discharge",
                                                       "mean_competence_standardized" = "Bird Competency Index"),

                                       size = .5) +
    coord_flip() +
    geom_vline(xintercept = 0, color = "black", linewidth = 1) +
    scale_y_discrete(expand = c(0,0.5)) +
    
    labs(x = "Coefficient Estimate", title = "Cx. quinquefasciatus") +

    theme(axis.title = element_text( size = 14,face = "bold"),
          axis.text.x = element_text(size = 14, face = "bold"), # element_blank()
          axis.text.y = element_text(size = 14),
          
          legend.title = element_text(face = "bold", size = 14),
          legend.position = "bottom",
          legend.text = element_text(size = 13),
          legend.margin = margin(0, 0, 0, 0), 
          legend.box.margin = margin(0, 0, 0, 0),
          
          plot.title = element_text(face = "bold", size = 14)) +
    scale_color_manual(name = "Fixed Effects",
                       values = getpal(6), 
                       labels = c("OLS", 
                                  "Clust", "Month", "Year",
                                  "Clust + Month", "Clust + Month + Year")) +
  guides(color = guide_legend(title.position = "top", direction = "horizontal",   nrow = 1))
  
  
## Combine
  
models_wnv_re_coeff <- ggarrange(models_wnv_re_tar_coeff + rremove("xlab") + rremove("ylab"), 
          models_wnv_re_quin_coeff + rremove("ylab"), 
          ncol = 1, align = "hv", 
          common.legend = TRUE, legend = "bottom",
          font.label = list(size = 12))


models_wnv_re_coeff_an <- annotate_figure(models_wnv_re_coeff,
                                            left = text_grob("Coefficient Estimate",
                                                             rot = 90, face = "bold", size = 11,
                                                             hjust = .3))

#ggsave(models_wnv_re_coeff_an, file = "figures/supplement/fig_s5.jpeg", dpi = 600, width = 9)
```


##Figure S6
Coefficient estimates for abundance models with different Conley errors

Fit models
```{r}
### within-estimator panel models
## TARSALIS
mod_abund_tar_conley_1km <- summary(mod_abund_tar, conley(1))
mod_abund_tar_conley_5km <- summary(mod_abund_tar, conley(5))
mod_abund_tar_conley_10km <- summary(mod_abund_tar, conley(10))
mod_abund_tar_conley_15km <- summary(mod_abund_tar, conley(15))
mod_abund_tar_conley_20km <- summary(mod_abund_tar, conley(20))
mod_abund_tar_conley_25km <- summary(mod_abund_tar, conley(25))


## QUINQ
mod_abund_quin_conley_1km <- summary(mod_abund_quin, conley(1))
mod_abund_quin_conley_5km <- summary(mod_abund_quin, conley(5))
mod_abund_quin_conley_10km <- summary(mod_abund_quin, conley(10))
mod_abund_quin_conley_15km <- summary(mod_abund_quin, conley(15))
mod_abund_quin_conley_20km <- summary(mod_abund_quin, conley(20))
mod_abund_quin_conley_25km <- summary(mod_abund_quin, conley(25))
```

Plot models
```{r}

## TARSALIS
models_abund_conley_tar_list <- list(mod_abund_tar_conley_1km, mod_abund_tar_conley_5km,
                                     mod_abund_tar_conley_10km, mod_abund_tar_conley_15km,
                                     mod_abund_tar_conley_20km, mod_abund_tar_conley_25km)


models_abund_conley_tar_coeff <- 
  modelplot(models_abund_conley_tar_list,
                                       coef_omit = "Intercept",
            
                                       coef_rename = c("pdsi_standardized_lag_1month" ="PDSI lag 1-month",
                                                       "woy_cms_mean_standardized" = "Kern River Discharge"),

                                       size = .5) +
    coord_flip() +
    geom_vline(xintercept = 0, color = "black", linewidth = 1) +
    scale_y_discrete(expand = c(0,0.5)) +
    
    labs(x = "Coefficient Estimate", title = "Cx. tarsalis") +

    theme(axis.title = element_text( size = 14,face = "bold"),
          axis.text.x = element_text(size = 14, face = "bold"), # element_blank()
          axis.text.y = element_text(size = 14),
          
          legend.title = element_text(face = "bold", size = 14),
          legend.position = "bottom",
          legend.text = element_text(size = 13),
          legend.margin = margin(0, 0, 0, 0), 
          legend.box.margin = margin(0, 0, 0, 0),
          
          plot.title = element_text(face = "bold", size = 14)) +
    scale_color_manual(name = "Conley Errors",
                       values = getpal(6), 
                       labels = c("1 km", 
                                  "5 km", "10 km",
                                  "15 km", "20 km", "25 km")) +
  guides(color = guide_legend(direction = "horizontal",   nrow = 1))
  
  
## QUINQ
models_abund_conley_quin_list <- list(mod_abund_quin_conley_1km, mod_abund_quin_conley_5km,
                                     mod_abund_quin_conley_10km, mod_abund_quin_conley_15km,
                                     mod_abund_quin_conley_20km, mod_abund_quin_conley_25km) 


models_abund_conley_quin_coeff <- 
  modelplot(models_abund_conley_quin_list,
                                       coef_omit = "Intercept",
            
                                       coef_rename = c("pdsi_standardized_lag_1month" ="PDSI lag 1-month",
                                                       "woy_cms_mean_standardized" = "Kern River Discharge"),

                                       size = .5) +
    coord_flip() +
    geom_vline(xintercept = 0, color = "black", linewidth = 1) +
    scale_y_discrete(expand = c(0,0.5)) +
    
    labs(x = "Coefficient Estimate", title = "Cx. quinquefasciatus") +

    theme(axis.title = element_text( size = 14,face = "bold"),
          axis.text.x = element_text(size = 14, face = "bold"), # element_blank()
          axis.text.y = element_text(size = 14),
          
          legend.title = element_text(face = "bold", size = 14),
          legend.position = "bottom",
          legend.text = element_text(size = 13),
          legend.margin = margin(0, 0, 0, 0), 
          legend.box.margin = margin(0, 0, 0, 0),
          
          plot.title = element_text(face = "bold", size = 14)) +
    scale_color_manual(name = "Conley Errors",
                       values = getpal(6), 
                       labels = c("1 km", 
                                  "5 km", "10 km",
                                  "15 km", "20 km", "25 km")) +
  guides(color = guide_legend(direction = "horizontal",   nrow = 1))
  
  
## Combine
  
models_abund_conley_coeff <- ggarrange(models_abund_conley_tar_coeff + rremove("xlab") + rremove("ylab"), 
          models_abund_re_quin_coeff + rremove("ylab"), 
          ncol = 1, align = "hv", 
          common.legend = TRUE, legend = "bottom",
          font.label = list(size = 12))


models_abund_conley_coeff_an <- annotate_figure(models_abund_conley_coeff,
                                            left = text_grob("Coefficient Estimate",
                                                             rot = 90, face = "bold", size = 11,
                                                             hjust = .3))

#ggsave(models_abund_conley_coeff_an, file = "figures/supplement/fig_s6.jpeg", dpi = 600)
```

##Figure S7
Coefficient estimates for WNV models with different Conley errors

Fit models
```{r}
### within-estimator panel models
## TARSALIS
mod_wnv_tar_conley_1km <- summary(mod_wnv_tar, conley(1))
mod_wnv_tar_conley_5km <- summary(mod_wnv_tar, conley(5))
mod_wnv_tar_conley_10km <- summary(mod_wnv_tar, conley(10))
mod_wnv_tar_conley_15km <- summary(mod_wnv_tar, conley(15))
mod_wnv_tar_conley_20km <- summary(mod_wnv_tar, conley(20))
mod_wnv_tar_conley_25km <- summary(mod_wnv_tar, conley(25))


## QUINQ
mod_wnv_quin_conley_1km <- summary(mod_wnv_quin, conley(1))
mod_wnv_quin_conley_5km <- summary(mod_wnv_quin, conley(5))
mod_wnv_quin_conley_10km <- summary(mod_wnv_quin, conley(10))
mod_wnv_quin_conley_15km <- summary(mod_wnv_quin, conley(15))
mod_wnv_quin_conley_20km <- summary(mod_wnv_quin, conley(20))
mod_wnv_quin_conley_25km <- summary(mod_wnv_quin, conley(25))
```

Plot models
```{r}

## TARSALIS
models_wnv_conley_tar_list <- list(mod_wnv_tar_conley_1km, mod_wnv_tar_conley_5km,
                                     mod_wnv_tar_conley_10km, mod_wnv_tar_conley_15km,
                                     mod_wnv_tar_conley_20km, mod_wnv_tar_conley_25km)


models_wnv_conley_tar_coeff <- 
  modelplot(models_wnv_conley_tar_list,
                                       coef_omit = "Intercept",
            
                                       coef_rename = c("pdsi_standardized_lag_1month" ="PDSI lag 1-month",
                                                       "woy_cms_mean_standardized" = "Kern River Discharge",
                                                       "mean_competence_standardized" = "Bird Competency Index"),

                                       size = .5) +
    coord_flip() +
    geom_vline(xintercept = 0, color = "black", linewidth = 1) +
    scale_y_discrete(expand = c(0,0.5)) +
    
    labs(x = "Coefficient Estimate", title = "Cx. tarsalis") +

    theme(axis.title = element_text( size = 14,face = "bold"),
          axis.text.x = element_text(size = 14, face = "bold"), # element_blank()
          axis.text.y = element_text(size = 14),
          
          legend.title = element_text(face = "bold", size = 14),
          legend.position = "bottom",
          legend.text = element_text(size = 13),
          legend.margin = margin(0, 0, 0, 0), 
          legend.box.margin = margin(0, 0, 0, 0),
          
          plot.title = element_text(face = "bold", size = 14)) +
    scale_color_manual(name = "Conley Errors",
                       values = getpal(6), 
                       labels = c("1 km", 
                                  "5 km", "10 km",
                                  "15 km", "20 km", "25 km")) +
  guides(color = guide_legend(direction = "horizontal",   nrow = 1))
  
  
## QUINQ
models_wnv_conley_quin_list <- list(mod_wnv_quin_conley_1km, mod_wnv_quin_conley_5km,
                                     mod_wnv_quin_conley_10km, mod_wnv_quin_conley_15km,
                                     mod_wnv_quin_conley_20km, mod_wnv_quin_conley_25km)


models_wnv_conley_quin_coeff <- 
  modelplot(models_wnv_conley_quin_list,
                                       coef_omit = "Intercept",
            
                                       coef_rename = c("pdsi_standardized_lag_1month" ="PDSI lag 1-month",
                                                       "woy_cms_mean_standardized" = "Kern River Discharge",
                                                       "mean_competence_standardized" = "Bird Competency Index"),

                                       size = .5) +
    coord_flip() +
    geom_vline(xintercept = 0, color = "black", linewidth = 1) +
    scale_y_discrete(expand = c(0,0.5)) +
    
    labs(x = "Coefficient Estimate", title = "Cx. quinquefasciatus") +

    theme(axis.title = element_text( size = 14,face = "bold"),
          axis.text.x = element_text(size = 14, face = "bold"), # element_blank()
          axis.text.y = element_text(size = 14),
          
          legend.title = element_text(face = "bold", size = 14),
          legend.position = "bottom",
          legend.text = element_text(size = 13),
          legend.margin = margin(0, 0, 0, 0), 
          legend.box.margin = margin(0, 0, 0, 0),
          
          plot.title = element_text(face = "bold", size = 14)) +
    scale_color_manual(name = "Conley Errors",
                       values = getpal(6), 
                       labels = c("1 km", 
                                  "5 km", "10 km",
                                  "15 km", "20 km", "25 km")) +
  guides(color = guide_legend(direction = "horizontal",   nrow = 1))
  
  
## Combine
  
models_wnv_conley_coeff <- ggarrange(models_wnv_conley_tar_coeff + rremove("xlab") + rremove("ylab"), 
          models_wnv_conley_quin_coeff + rremove("ylab"), 
          ncol = 1, align = "hv", 
          common.legend = TRUE, legend = "bottom",
          font.label = list(size = 12))


models_wnv_conley_coeff_an <- annotate_figure(models_wnv_conley_coeff,
                                            left = text_grob("Coefficient Estimate",
                                                             rot = 90, face = "bold", size = 11,
                                                             hjust = .3))

#ggsave(models_wnv_conley_coeff_an, file = "figures/supplement/fig_s7.jpeg", dpi = 600, width = 9)

```

##Figure S8
Coefficient estimates for abundance models with different standard errors

Fit models
```{r}
## need to omit NA for the calculations to work

mod_abund_tar_re_none_nona <- feols(log(mos_per_trap_night + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized, 
                       
                       vcov = "conley",
                       data = na.omit(abund_tar))


mod_abund_quin_re_none_nona <- feols(log(mos_per_trap_night + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized, 
                       
                       vcov = "conley",
                       data = na.omit(abund_quin))


## then calculate various standard errors

## sandwhich errors
vc <- list(
  "Standard"              = vcov(mod_abund_tar_re_none_nona),
  "Sandwich (basic)"      = sandwich(mod_abund_tar_re_none_nona),
  "Clustered"             = vcovCL(mod_abund_tar_re_none_nona, cluster = ~ clust),
  "Clustered (two-way)"   = vcovCL(mod_abund_tar_re_none_nona, cluster = ~ clust + month),
  "HC3"                   = vcovHC(mod_abund_tar_re_none_nona),
  "Andrews' kernel HAC"   = kernHAC(mod_abund_tar_re_none_nona),
  "Newey-West"            = NeweyWest(mod_abund_tar_re_none_nona),
  "Bootstrap"             = vcovBS(mod_abund_tar_re_none_nona),
  "Bootstrap (clustered)" = vcovBS(mod_abund_tar_re_none_nona, cluster = ~ clust)
)


models_abund_std_tar_list  <- lapply(vc, coeftest, x = mod_abund_tar_re_none_nona)


## QUINQ

## sandwhich errors
vc <- list(
  "Standard"              = vcov(mod_abund_quin_re_none_nona),
  "Sandwich (basic)"      = sandwich(mod_abund_quin_re_none_nona),
  "Clustered"             = vcovCL(mod_abund_quin_re_none_nona, cluster = ~ clust),
  "Clustered (two-way)"   = vcovCL(mod_abund_quin_re_none_nona, cluster = ~ clust + month),
  "HC3"                   = vcovHC(mod_abund_quin_re_none_nona),
  "Andrews' kernel HAC"   = kernHAC(mod_abund_quin_re_none_nona),
  "Newey-West"            = NeweyWest(mod_abund_quin_re_none_nona),
  "Bootstrap"             = vcovBS(mod_abund_quin_re_none_nona),
  "Bootstrap (clustered)" = vcovBS(mod_abund_quin_re_none_nona, cluster = ~ clust)
)


models_abund_std_quin_list  <- lapply(vc, coeftest, x = mod_abund_quin_re_none_nona)

```

Plot models
```{r}
models_abund_std_tar_coeff <- 
  modelplot(models_abund_std_tar_list,
                                       coef_omit = "(Intercept)",
            
                                       coef_rename = c("pdsi_standardized_lag_1month" ="PDSI lag 1-month",
                                                       "woy_cms_mean_standardized" = "Kern River Discharge"),

                                       size = .5) +
    coord_flip() +
    geom_vline(xintercept = 0, color = "black", linewidth = 1) +
    scale_y_discrete(expand = c(0,0.5)) +
    
    labs(x = "Coefficient Estimate", title = "Cx. tarsalis") +

    theme(axis.title = element_text( size = 14,face = "bold"),
          axis.text.x = element_text(size = 14, face = "bold"), # element_blank()
          axis.text.y = element_text(size = 14),
          
          legend.title = element_text(face = "bold", size = 14),
          #legend.position = "bottom",
          legend.text = element_text(size = 13),
          legend.margin = margin(0, 0, 0, 0), 
          legend.box.margin = margin(0, 0, 0, 0),
          
          plot.title = element_text(face = "bold", size = 14)) +
    scale_color_manual(name = "Standard Errors",
                       values = getpal(9)) 

## QUINQ


models_abund_std_quin_coeff <- 
  modelplot(models_abund_std_tar_list,
                                       coef_omit = "(Intercept)",
            
                                       coef_rename = c("pdsi_standardized_lag_1month" ="PDSI lag 1-month",
                                                       "woy_cms_mean_standardized" = "Kern River Discharge"),

                                       size = .5) +
    coord_flip() +
    geom_vline(xintercept = 0, color = "black", linewidth = 1) +
    scale_y_discrete(expand = c(0,0.5)) +
    
    labs(x = "Coefficient Estimate", title = "Cx. quinquefasciatus") +

    theme(axis.title = element_text( size = 14,face = "bold"),
          axis.text.x = element_text(size = 14, face = "bold"), # element_blank()
          axis.text.y = element_text(size = 14),
          
          legend.title = element_text(face = "bold", size = 14),
          #legend.position = "bottom",
          legend.text = element_text(size = 13),
          legend.margin = margin(0, 0, 0, 0), 
          legend.box.margin = margin(0, 0, 0, 0),
          
          plot.title = element_text(face = "bold", size = 14)) +
    scale_color_manual(name = "Standard Errors",
                       values = getpal(9)) 


## Combine
  
models_abund_std <- ggarrange(models_abund_std_tar_coeff + rremove("xlab") + rremove("ylab"), 
          models_abund_std_quin_coeff + rremove("ylab"), 
          ncol = 1, align = "hv", 
          common.legend = TRUE, legend = "right",
          font.label = list(size = 12))


models_abund_std_an <- annotate_figure(models_abund_std,
                                            left = text_grob("Coefficient Estimate",
                                                             rot = 90, face = "bold", size = 11,
                                                             hjust = .3))

#ggsave(models_abund_std_an, file = "figures/supplement/fig_s8.jpeg", dpi = 600)

```

##Figure S9

Fit models
```{r}
## need to omit NA for the calculations to work

mod_wnv_tar_re_none_nona <- feols(log(mir + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized +
                         mean_competence_standardized, 
                       
                       vcov = "conley",
                       data = na.omit(wnv_tar))


mod_wnv_quin_re_none_nona <- feols(log(mir + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized +
                         mean_competence_standardized, 
                       
                       vcov = "conley",
                       data = na.omit(wnv_quin))


## then calculate various standard errors
## sandwhich errors
vc <- list(
  "Standard"              = vcov(mod_wnv_tar_re_none_nona),
  "Sandwich (basic)"      = sandwich(mod_wnv_tar_re_none_nona),
  "Clustered"             = vcovCL(mod_wnv_tar_re_none_nona, cluster = ~ clust),
  "Clustered (two-way)"   = vcovCL(mod_wnv_tar_re_none_nona, cluster = ~ clust + month),
  "HC3"                   = vcovHC(mod_wnv_tar_re_none_nona),
  "Andrews' kernel HAC"   = kernHAC(mod_wnv_tar_re_none_nona),
  "Newey-West"            = NeweyWest(mod_wnv_tar_re_none_nona),
  "Bootstrap"             = vcovBS(mod_wnv_tar_re_none_nona),
  "Bootstrap (clustered)" = vcovBS(mod_wnv_tar_re_none_nona, cluster = ~ clust)
)


models_wnv_std_tar_list  <- lapply(vc, coeftest, x = mod_wnv_tar_re_none_nona)


## QUINQ
# mod_wnv_quin_re_none # this is OLS


## sandwhich errors
vc <- list(
  "Standard"              = vcov(mod_wnv_quin_re_none_nona),
  "Sandwich (basic)"      = sandwich(mod_wnv_quin_re_none_nona),
  "Clustered"             = vcovCL(mod_wnv_quin_re_none_nona, cluster = ~ clust),
  "Clustered (two-way)"   = vcovCL(mod_wnv_quin_re_none_nona, cluster = ~ clust + month),
  "HC3"                   = vcovHC(mod_wnv_quin_re_none_nona),
  "Andrews' kernel HAC"   = kernHAC(mod_wnv_quin_re_none_nona),
  "Newey-West"            = NeweyWest(mod_wnv_quin_re_none_nona),
  "Bootstrap"             = vcovBS(mod_wnv_quin_re_none_nona),
  "Bootstrap (clustered)" = vcovBS(mod_wnv_quin_re_none_nona, cluster = ~ clust)
)


models_wnv_std_quin_list  <- lapply(vc, coeftest, x = mod_wnv_quin_re_none_nona)

```

Plot models
```{r}
## TARSALIS


models_wnv_std_tar_coeff <- 
  modelplot(models_wnv_std_tar_list,
                                       coef_omit = "(Intercept)",
            
                                       coef_rename = c("pdsi_standardized_lag_1month" ="PDSI lag 1-month",
                                                       "woy_cms_mean_standardized" = "Kern River Discharge", 
                                                       "mean_competence_standardized" = "Bird Competency Index"),

                                       size = .5) +
    coord_flip() +
    geom_vline(xintercept = 0, color = "black", linewidth = 1) +
    scale_y_discrete(expand = c(0,0.5)) +
    
    labs(x = "Coefficient Estimate", title = "Cx. tarsalis") +

    theme(axis.title = element_text( size = 14,face = "bold"),
          axis.text.x = element_text(size = 14, face = "bold"), # element_blank()
          axis.text.y = element_text(size = 14),
          
          legend.title = element_text(face = "bold", size = 14),
          #legend.position = "bottom",
          legend.text = element_text(size = 13),
          legend.margin = margin(0, 0, 0, 0), 
          legend.box.margin = margin(0, 0, 0, 0),
          
          plot.title = element_text(face = "bold", size = 14)) +
    scale_color_manual(name = "Standard Errors",
                       values = getpal(9))

## QUINQ

models_wnv_std_quin_coeff <- 
  modelplot(models_wnv_std_quin_list,
                                       coef_omit = "(Intercept)",
            
                                       coef_rename = c("pdsi_standardized_lag_1month" ="PDSI lag 1-month",
                                                       "woy_cms_mean_standardized" = "Kern River Discharge",
                                                       "mean_competence_standardized" = "Bird Competency Index"),

                                       size = .5) +
    coord_flip() +
    geom_vline(xintercept = 0, color = "black", linewidth = 1) +
    scale_y_discrete(expand = c(0,0.5)) +
    
    labs(x = "Coefficient Estimate", title = "Cx. quinquefasciatus") +

    theme(axis.title = element_text( size = 14,face = "bold"),
          axis.text.x = element_text(size = 14, face = "bold"), # element_blank()
          axis.text.y = element_text(size = 14),
          
          legend.title = element_text(face = "bold", size = 14),
          #legend.position = "bottom",
          legend.text = element_text(size = 13),
          legend.margin = margin(0, 0, 0, 0), 
          legend.box.margin = margin(0, 0, 0, 0),
          
          plot.title = element_text(face = "bold", size = 14)) +
    scale_color_manual(name = "Standard Errors",
                       values = getpal(9))


## Combine
  
models_wnv_std <- ggarrange(models_wnv_std_tar_coeff + rremove("xlab") + rremove("ylab"), 
          models_wnv_std_quin_coeff + rremove("ylab"), 
          ncol = 1, align = "hv", 
          common.legend = TRUE, legend = "right",
          font.label = list(size = 12))


models_wnv_std_an <- annotate_figure(models_wnv_std,
                                            left = text_grob("Coefficient Estimate",
                                                             rot = 90, face = "bold", size = 11,
                                                             hjust = .3))

#ggsave(models_wnv_std_an, file = "figures/supplement/fig_s9.jpeg", dpi = 600, width = 13)

```


##Figure S10
Coefficient estimates for abund & WNV models 

Fit models
```{r}
### within-estimator panel models
## ABUNDANCES
mod_abund_tar_temp <- feols(log(mos_per_trap_night + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized +
                         temp_max_c_standardized |
                          clust + month, 
                       
                       vcov = "conley",
                       data = abund_tar_panel)




mod_abund_quin_temp <- feols(log(mos_per_trap_night + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized +
                         temp_max_c_standardized |
                          clust + month, 
                       
                       vcov = "conley",
                       data = abund_quin_panel)


## WNV MIR
mod_wnv_tar_temp <- feols(log(mir + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized +
                         mean_competence_standardized +
                         temp_max_c_standardized |
                          clust + month, 
                       
                       vcov = "conley",
                       data = wnv_tar_panel)




mod_wnv_quin_temp <- feols(log(mir + 1) ~ 
                         pdsi_standardized_lag_1month + 
                         woy_cms_mean_standardized +
                         mean_competence_standardized +
                         temp_max_c_standardized |
                          clust + month, 
                       
                       vcov = "conley",
                       data = wnv_quin_panel)


```


Plot models
```{r}

## ABUNDANCE
models_abund_temp <- list(mod_abund_tar_temp, mod_abund_quin_temp)


models_abund_temp_coeff <- 
  modelplot(models_abund_tar_temp,
                                       coef_omit = "Intercept",
            
                                       coef_rename = c("pdsi_standardized_lag_1month" ="PDSI lag 1-month",
                                                       "woy_cms_mean_standardized" = "Kern River Discharge",
                                                       "temp_max_c_standardized" = "Max Temp"),

                                       size = .5) +
    coord_flip() +
    geom_vline(xintercept = 0, color = "black", linewidth = 1) +
    scale_y_discrete(expand = c(0,0.1)) +
    
    labs(x = "Coefficient Estimate", title = "Abundance") +

    theme(axis.title = element_text( size = 14,face = "bold"),
          axis.text.x = element_text(size = 14, face = "bold"), # element_blank()
          axis.text.y = element_text(size = 14),
          
          legend.title = element_text(face = "bold", size = 14),
          legend.position = "bottom",
          legend.text = element_text(size = 13),
          legend.margin = margin(0, 0, 0, 0), 
          legend.box.margin = margin(0, 0, 0, 0),
          
          plot.title = element_text(face = "bold", size = 14)) +
    scale_color_manual(name = "Species",
                       values = c("#008000","#8b8c89"), 
                       labels = c("Cx. tarsalis", 
                                  "Cx. quinquefasciatus"))
  
  
## WNV MIR
models_wnv_temp <- list(mod_wnv_tar_temp, mod_wnv_quin_temp)


models_wnv_temp_coeff <- 
  modelplot(models_wnv_temp,
                                       coef_omit = "Intercept",
            
                                       coef_rename = c("pdsi_standardized_lag_1month" ="PDSI lag 1-month",
                                                       "woy_cms_mean_standardized" = "Kern River Discharge",
                                                       "mean_competence_standardized" = "Bird Competency Index",
                                                       "temp_max_c_standardized" = "Max Temp"),

                                       size = .5) +
    coord_flip() +
    geom_vline(xintercept = 0, color = "black", linewidth = 1) +
    scale_y_discrete(expand = c(0,0.1)) +
    
    labs(x = "Coefficient Estimate", title = "WNV MIR") +

    theme(axis.title = element_text( size = 14,face = "bold"),
          axis.text.x = element_text(size = 14, face = "bold"), # element_blank()
          axis.text.y = element_text(size = 14),
          
          legend.title = element_text(face = "bold", size = 14),
          legend.position = "bottom",
          legend.text = element_text(size = 13),
          legend.margin = margin(0, 0, 0, 0), 
          legend.box.margin = margin(0, 0, 0, 0),
          
          plot.title = element_text(face = "bold", size = 14)) +
    scale_color_manual(name = "Species",
                       values = c("#008000","#8b8c89"), 
                       labels = c("Cx. tarsalis", 
                                  "Cx. quinquefasciatus"))  


## Combine
  
models_both_temp <- ggarrange(models_abund_temp_coeff + rremove("xlab") + rremove("ylab"), 
          models_wnv_temp_coeff + rremove("ylab"), 
          ncol = 1, align = "hv", 
          common.legend = TRUE, legend = "bottom",
          font.label = list(size = 12))  


models_both_temp_an <- annotate_figure(models_both_temp,
                                            left = text_grob("Coefficient Estimate",
                                                             rot = 90, face = "bold", size = 11,
                                                             hjust = .3))


#ggsave(models_both_temp_an, file ="figures/supplement/fig_s10.jpeg", dpi = 600, width = 9)
```

